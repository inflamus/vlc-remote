var maxSegments=3,movieKeywords=["1080p","720p","480p","blurayrip","brrip","divx","dvdrip","hdrip","hdtv","tvrip","xvid","camrip"],excluded={};movieKeywords.forEach(function(e){excluded[e]=1});var SEGMENTS_SPLIT=/\.| |-|;|_/g,MATCH_FILES=/.mp4$|.mkv$|.avi$/,minYear=1900,maxYear=2030;function simplifyName(e){return e.toLowerCase().trim().replace(/\([^\(]+\)$/,"").replace(/&/g,"and").replace(/[^0-9a-z ]+/g," ").split(" ").filter(function(e){return e}).join(" ")}function parseVideoName(e,a){var r,i,a=a||{},t={},n=e.replace(/\\/g,"/").split("/").reverse().filter(function(e){return e}).slice(0,maxSegments),s=n[0].split(/\.| |_/);function o(){return t.hasOwnProperty("season")&&!isNaN(t.season)}function d(){return Array.isArray(t.episode)&&t.episode.length}[n[0],n[1]].filter(function(e){return e}).forEach(function(e){for(var a,r=/\b\d{4}\b/g;a=r.exec(e);){var i=parseInt(a[0],10);i>=minYear&&i<=maxYear&&(t.year=i)}});var c=function(e){return("00"+e).slice(-2)};[n[0],n[1]].filter(function(e){return e}).forEach(function(e){var a=e.match(/(\d\d\d\d)(\.|-| )(\d\d)(\.|-| )(\d\d)/);if(a&&a[1]){var r=parseInt(a[1],10);r>=minYear&&r<=maxYear&&(t.aired=[r,c(a[3]),c(a[5])].join("-"))}}),[n[0],n[1]].forEach(function(e){e&&e.split(/\.| |_/).forEach(function(e,a){var r=e.match(/S(\d{1,2})/i);r&&(t.season=parseInt(r[1],10));var i=e.match(/E(\d{2})/ig);i&&(t.episode=i.map(function(e){return parseInt(e.slice(1),10)}));var n=e.match(/(\d\d?)x(\d\d?)/i);n&&(t.season=parseInt(n[1],10),t.episode=[parseInt(n[2],10)])});var a=e&&e.replace(/\.| |;|_/g," ").match(/^([a-zA-Z0-9,-?!'& ]*) S(\d{1,2})E(\d{2})/i);!t.name&&t.season&&t.episode&&a&&a[1]&&(t.name=a[1])});var m=n[0].match(/[^\da-zA-Z](\d\d?)\.(\d\d?)[^\da-zA-Z]/i);if(o()&&d()||!m||t.year||(t.season=parseInt(m[1],10),t.episode=[parseInt(m[2],10)]),!(o()&&d())&&!a.strict){var p=s.reverse().map(function(e){return e.match(RegExp("\\d\\d\\d\\d?e"))&&(e=e.slice(0,-1)),e.match(RegExp("s\\d\\d\\d\\d?"))&&(e=e.slice(1)),e}).filter(function(e){return!isNaN(e)&&(3==e.length||!t.year&&4==e.length)})[0];p&&(!t.year||t.year&&s.indexOf(p.toString())<s.indexOf(t.year.toString()))&&(t.episode=[parseInt(p.slice(-2),10)],t.season=parseInt(p.slice(0,-2),10))}if(!o()){var $=n.join("/").match(/season(\.| )?(\d{1,2})/ig);$&&(t.season=parseInt($[0].match(/\d/g).join(""),10));var h=n.join("/").match(/Season (\d{1,2}) - (\d{1,2})/i);h&&(t.season=parseInt(h[1],10),t.episode=[parseInt(h[2],10)])}if(!d()){var f=n.join("/").match(/ep(isode)?(\.| )?(\d+)/ig);f&&(t.episode=[parseInt(f[0].match(/\d/g).join(""),10)])}var l=n[0].match(/[ _.-]*(?:cd|dvd|p(?:ar)?t|dis[ck]|d)[ _.-]*(\d)[^\d]/);return l&&(t.diskNumber=parseInt(l[1],10)),(a.fromInside?n:[].concat(n).reverse()).forEach(function(e,a){if(e==n[0]){var i,s=(e=e.split(".").slice(0,-1).join(".")).match(/^\[(.*?)\]/);s&&(e=e.slice(s[0].length))}var o=e.indexOf("[");o>-1&&(e=e.slice(0,o));var d=e.split(SEGMENTS_SPLIT),c=[];r=r||e.match(/^sample/i)||e.match(/^etrg/i),!t.name&&(d.some(function(e,a){if(i=a,!(e.match("^[a-zA-Z,?!'&]*$")||!isNaN(e)&&e.length<=2||!isNaN(e)&&0==a)||excluded[e.toLowerCase()]||["ep","episode","season"].indexOf(e.toLowerCase())>-1&&!isNaN(d[a+1]))return!0;c.push(e)}),(1!=c.length||isNaN(c[0]))&&(t.name=c.filter(function(e){return e&&e.length>0}).map(function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}).join(" ")))}),r=r||"sample"==(n[1]||"").toLowerCase(),i=a.strict?t.hasOwnProperty("year"):t.hasOwnProperty("year")||t.hasOwnProperty("diskNumber")||movieKeywords.some(function(e){return n.join("/").toLowerCase().search(e)>-1}),t.name&&t.aired&&(t.type="series"),t.name&&o()&&d()?t.type="series":t.name&&i?t.type="movie":"movie"!=t.type&&t.name&&o()?t.type="extras":t.type="other",a.fileLength&&a.fileLength<(t.type.match(/movie/)?80:50)*1048576&&t.type.match(/movie|series/)&&!r&&(t.type="other"),("series"!=t.type||t.aired)&&(delete t.episode,delete t.season),"series"==t.type&&t.year&&(t.aired=t.aired||t.year,delete t.year),t.type+=r?"-sample":"",t.name=t.name&&simplifyName(t.name),a.hints&&a.hints.imdb_id&&(t.imdb_id=a.hints.imdb_id),t.tag=[],e.match(/1080p/i)&&(t.tag.push("hd"),t.tag.push("1080p")),e.match(/720p/i)&&t.tag.push("720p"),e.match(/480p/i)&&t.tag.push("480p"),r&&t.tag.push("sample"),t}