var video_types="asf avi divx drc dv f4v flv gxf iso m1v m2v m2t m2ts m4v mkv mov mp2 mp4 mpeg mpeg1 mpeg2 mpeg4 mpg mts mtv mxf mxg nuv ogg ogm ogv ogx ps rec rm rmvb ts vob wmv xesc".split(" "),audio_types="3ga a52 aac ac3 ape awb dts flac it m4a m4p mka mlp mod mp1 mp2 mp3 oga ogg oma s3m spx thd tta wav wma wv xm".split(" "),playlist_types="asx b4s cue ifo m3u m3u8 pls ram rar sdp vlc xspf zip conf".split(" "),subtitle_types=["srt","idx","ass","ssa"],_server="http://"+window.location.hostname+
":"+window.location.port,server=localStorage.server?localStorage.server:_server,_defaultBrowse="file://~",defaultBrowse=localStorage.defaultBrowse?"file://"+encodeURIComponent(localStorage.defaultBrowse):_defaultBrowse,maxVolume=localStorage.maxVolume?localStorage.maxVolume:!0,useChapters=localStorage.useChapters?localStorage.useChapters:!0,forwardDuration=localStorage.forwardDuration?localStorage.forwardDuration:15,backwardDuration=localStorage.backwardDuration?localStorage.backwardDuration:15,_updateInterval=
5,updateInterval=localStorage.updateInterval?localStorage.updateInterval:_updateInterval;
function VLC(){that=this;this.titleBar=$("<header>",{"class":"bar bar-nav"}).append('<h1 class="title"><img src=img/vlc16x16.png alt="VideoLan Logo" class="icon" /> VLC - Remote Controller</h1>').append('<a class="icon icon-gear pull-right" href=#settings></a>').appendTo("body");this.buildSettings();this.infoModal=this._modal("info",'<span class="icon icon-info"></span> Informations');this.streamModal=this._modal("streams",'<span class="icon icon-more"></span> Streams').find(".content").append("<ul class=table-view></ul>");
this.plModal=this._modal("playlist",'<span class="icon icon-list"></span> Playlists').find(".content").append('<ul class="table-view"></ul>').find("ul.table-view");this.content=$('<div class=content style="text-align:center;">').appendTo("body");$("<div class=slider>").append($("<div class=slide-group>").append(this.slide=$("<div class=slide>"))).css("backgroundColor","#fff").on("slide",function(){img=$(this).find("img");offset=img.offset();-70>parseInt(offset.left)?that.sendCommand("pl_next").updateStatus():
70<parseInt(offset.left)&&that.sendCommand("pl_previous").updateStatus()}).appendTo(this.content);this.albumArt=$('<img id="albumArt" style="margin-top:44px; margin-bottom:44px;margin-left: auto; margin-right:auto; max-width:100%;" alt=albumart src="img/vlc-48.png" />').appendTo(this.slide);this.durationInfo=$('<span class="slide-text">').appendTo(this.slide);this.errorDiv=$("<div>",{"class":"error"}).appendTo(this.content);this.navBar=$("<nav>",{"class":"bar bar-tab"}).appendTo("body");this.nav=
{};this.staticButtons();this.browseModal=this._modal("browse",'<span class="icon icon-search"></span> Browse').append($("<footer>",{"class":"bar bar-footer"}).append($('<input type="search" placeholder="Search">').on("keyup",function(){var a=$(this).val().toLowerCase();""==a?$("#browse .content ul.table-view > li").show():$("#browse .content ul.table-view > li").each(function(){0<=$(this).text().toLowerCase().indexOf(a)?$(this).show():$(this).hide()})}).on("focus",function(){$(this).val("").trigger("keyup")}))).find(".content").css("padding-bottom",
"44px");this.Browse();setInterval(function(){that.updateStatus()},1E3*updateInterval);return this}
VLC.prototype={updateStatus:function(){that=this;$.ajax({url:server+"/requests/status.json",success:function(a,b,d){that.status=a;that.updateButtons();that.updateArt();that.error(!1);$("p#version").text(a.version)},error:function(a,b,d){that.error("VLC Connection has been lost.")},dataType:"json"});return this},sendCommand:function(a){that=this;"object"!=typeof a&&(a={command:a});$.ajax({url:server+"/requests/status.json",data:a,success:function(a){that.status=a},dataType:"json"});return this},Pause:function(){this.sendCommand("pl_pause").updateButtons();
return this},Play:function(a){void 0==a?this.sendCommand("pl_play").updateButtons():this.sendCommand({command:"pl_play",id:a}).updateButtons();return this},Stop:function(){this.sendCommand("pl_stop").updateButtons();return this},_Timeout:!1,Next:function(){0==arguments.length?(that=this,this._Timeout?(clearTimeout(this._Timeout),1<this.status.information.chapters.length&&this.status.information.chapter<this.status.information.chapters.length&&useChapters?this.sendCommand({command:"chapter",val:this.status.information.chapter+
1}):this.sendCommand("pl_next"),this._Timeout=setTimeout(function(){clearTimeout(that._Timeout);that._Timeout=!1},5E3)):this._Timeout=setTimeout(function(){that.Next(1)},1E3)):(this._Timeout=!1,this.Seek("+"+forwardDuration+"s"));return this},Prev:function(){0==arguments.length?(that=this,this._Timeout?(clearTimeout(this._Timeout),1<this.status.information.chapters.length&&0<this.status.information.chapter&&useChapters?this.sendCommand({command:"chapter",val:this.status.information.chapter-1}):this.sendCommand("pl_previous"),
this._Timeout=setTimeout(function(){clearTimeout(that._Timeout);that._Timeout=!1},5E3)):this._Timeout=setTimeout(function(){that.Prev(1)},1E3)):(this._Timeout=!1,this.Seek("-"+backwardDuration+"s"));return this},Seek:function(a){this.sendCommand({command:"seek",val:a});return this},Fullscreen:function(){this.sendCommand("fullscreen");return this},_modal:function(a,b){return $("<div>",{id:a,"class":"modal"}).append($("<header>",{"class":"bar bar-nav"}).append($("<a>",{"class":"icon icon-close pull-right",
href:"javascript:void(0);"}).click(function(){$(this).parent().parent().removeClass("active")})).append($("<h1>",{"class":"title",html:b}))).append($("<div>",{"class":"content"})).appendTo("body")},Browse:function(a){that=this;a=void 0==a?defaultBrowse:a;$.ajax({url:"requests/browse.json",data:{uri:a},success:function(a){that.browseModal.empty().append($('<ul class="table-view">'));$(a.element).each(function(){ext=this.name.substr(this.name.lastIndexOf(".")+1).toLowerCase();-1!=$.inArray(ext,video_types)||
-1!=$.inArray(ext,audio_types)||-1!=$.inArray(ext,playlist_types)||"dir"==this.type?that.browseModal.find("ul.table-view").append($('<li class="table-view-cell">').append("dir"==this.type?".."==this.name?$('<a data-opendir="'+this.uri+'" class="navigate-left"><span class="pull-right">Back</span></a>').click(function(){that.Browse($(this).attr("data-opendir"))}):$('<a data-opendir="'+this.uri+'" class="navigate-right">'+this.name+"</a>").click(function(){that.Browse($(this).attr("data-opendir"))}):
$('<a data-openfile="'+this.uri+'"><span class="media-object pull-left icon icon-play"></span> '+this.name+"</a>").click(function(){that.sendCommand({command:"in_play",input:$(this).attr("data-openfile")});that.browseModal.parent().removeClass("active")}))):-1!=$.inArray(ext,subtitle_types)&&that.browseModal.find("ul.table-view").append($('<li class="table-view-cell">').append($('<a data-openfile="'+this.uri+'"><span class="media-object pull-left icon-bars icon"></span> '+this.name+"</a>").click(function(){that.sendCommand({command:"addsubtitle",
val:$(this).attr("data-openfile")});that.browseModal.parent().removeClass("active")})))});return this},error:function(){setTimeout(function(){that.Browse(a)},1E3)},dataType:"json"});return this},buildSettings:function(){this._modal("settings",'<span class="icon icon-gear"></span> Settings').find(".content").append($("<ul>",{"class":"table-view"}).append($("<li>",{"class":"table-view-divider"}).append("VLC Location")).append($("<li>",{"class":"input-row"}).append("<label>Server</label>").append($("<input>",
{type:"text",value:localStorage.server,disabled:!0,placeholder:server}).change(function(){""!=$(this).val()?server=localStorage.server=$(this).val():(delete localStorage.server,server=_server)}))).append($("<li>",{"class":"table-view-divider"}).append("Configuration")).append($("<li>",{"class":"input-row"}).append("<label>Update Interval</label>").append($("<input>",{type:"number",value:localStorage.updateInterval,placeholder:_updateInterval}).change(function(){""!=$(this).val()?localStorage.updateInterval=
updateInterval=$(this).val():(delete localStorage.updateInterval,updateInterval=_updateInterval)}))).append($("<li>",{"class":"input-row"}).append("<label>Browser</label>").append($("<input>",{type:"text",value:localStorage.defaultBrowse,placeholder:"~"}).change(function(){""!=$(this).val()?localStorage.defaultBrowse=defaultBrowse=$(this).val():(delete localStorage.defaultBrowse,defaultBrowse=_defaultBrowse)}))).append($("<li>",{"class":"table-view-cell"}).append("Max Vol. 100%").append($("<div>",
{"class":maxVolume?"toggle active":"toggle"}).append($("<div>",{"class":"toggle-handle"})).on("toggle",function(){maxVolume=$(this).hasClass("active")?!0:!1;localStorage.maxVolume=maxVolume})).append("<p>Prevent volume from going higher than 100%</p>")).append($("<li>",{"class":"table-view-cell"}).append("Chapters").append($("<div>",{"class":useChapters?"toggle active":"toggle"}).append($("<div>",{"class":"toggle-handle"})).on("toggle",function(){useChapters=$(this).hasClass("active")?!0:!1;localStorage.useChapters=
useChapters})).append("<p>This will first seek for the next or previous chapter within the playing file, instead of switching to the next file of the internal VLC playlist.</p>")).append($("<li>",{"class":"input-row"}).append("<label>Forward</label>").append($("<input>",{type:"number",placeholder:"15 seconds",value:localStorage.forwardDuration}).change(function(){""!=$(this).val()?localStorage.forwardDuration=forwardDuration=$(this).val():(delete localStorage.forwardDuration,forwardDuration=15)}))).append($("<li>",
{"class":"input-row"}).append("<label>Backward</label>").append($("<input>",{type:"number",placeholder:"15 seconds",value:localStorage.backwardDuration}).change(function(){""!=$(this).val()?localStorage.backwardDuration=backwardDuration=$(this).val():(delete localStorage.backwardDuration,backwardDuration=15)}))).append($("<li>",{"class":"table-view-cell"}).append("VLC Version").append('<p id="version">Unknown</p>')));return this},Volume:function(a){return(256<=this.status.volume||230<this.status.volume)&&
a&&1==maxVolume?this.sendCommand({command:"volume",val:256}):26>=this.status.volume&&!a?this.sendCommand({command:"volume",val:0}):this.sendCommand({command:"volume",val:a?this.status.volume+26:this.status.volume-26})},staticButtons:function(){that=this;this.nav.search=$('<a class="tab-item" href=#browse>').append('<span class="icon icon-search"></span>').append('<span class="tab-label">Open</span>').appendTo(this.navBar);this.nav.playpause=$('<a class="tab-item" href="javascript:void(0);">').appendTo(this.navBar);
this.nav.stop=$('<a class="tab-item" href=javascript:void(0);>').append('<span class="icon icon-stop"></span>').append('<span class="tab-label">Stop</span>').appendTo(this.navBar).click(function(){that.Stop()});this.nav.fullscreen=$('<a class="tab-item" href="javascript:void(0);">').append('<span class="icon icon-code"></span>').append('<span class="tab-label">Fullscreen</span>').appendTo(this.navBar).click(function(){that.Fullscreen();$(this).toggleClass("active")});this.nav.volume1=$('<a class="tab-item" href=javascript:void(0);>').append('<span class="icon icon-sound4"></span>').append('<span class="tab-label">Volume -</span>').appendTo(this.navBar).click(function(){that.Volume(0)});
this.nav.volume2=$('<a class="tab-item" href=javascript:void(0);>').append('<span class="icon icon-sound"></span>').append('<span class="tab-label">Volume +</span>').appendTo(this.navBar).click(function(){that.Volume(1)});return this},updateButtons:function(){that=this;1==this.status.fullscreen?this.nav.fullscreen.hasClass("active")||this.nav.fullscreen.addClass("active"):this.nav.fullscreen.removeClass("active");"playing"==this.status.state?this.nav.playpause.empty().append('<span class="icon icon-pause"></span>').append('<span class="tab-label">Pause</span>').unbind("click").click(function(){that.Pause()}):
this.nav.playpause.empty().append('<span class="icon icon-play"></span>').append('<span class="tab-label">Play</span>').unbind("click").click(function(){that.Play()});volume=Math.floor(this.status.volume/2.56/25);switch(volume){default:case 0:this.nav.volume1.html('<span class="icon icon-sound4"></span><span class="tab-label">Volume -</span>');this.nav.volume2.html('<span class="icon icon-sound3"></span><span class="tab-label">Volume +</span>');break;case 1:case 2:this.nav.volume1.html('<span class="icon icon-sound3"></span><span class="tab-label">Volume -</span>');
this.nav.volume2.html('<span class="icon icon-sound2"></span><span class="tab-label">Volume +</span>');break;case 3:case 4:case 5:case 6:case 7:case 8:this.nav.volume1.html('<span class="icon icon-sound2"></span><span class="tab-label">Volume -</span>'),this.nav.volume2.html('<span class="icon icon-sound"></span><span class="tab-label">Volume +</span>')}this.durationInfo.text((this.status.position*this.status.length).toString().toHHMMSS()+" \u2014 "+this.status.length.toString().toHHMMSS());return this},
buildPlaylist:function(a){that=this;$.each(a.children,function(){that.plModal.append('<li class="table-view-divider">'+this.name+"</li>");$.each(this.children,function(){that.plModal.append($("<li>",{"class":"table-view-cell"}).append(this.current?'<span class="media-object pull-left icon icon-play"></span> '+this.name:$('<a data-id="'+this.id+'" class="navigate-right" href=javascript:;><span class="badge">'+this.duration.toString().toHHMMSS()+"</span>"+this.name+"</a>").click(function(){that.Play($(this).attr("data-id")).plModal.parent().parent().removeClass("active")})))})});
return this},updateArt:function(){that=this;this.status.information?this.actualImg!=this.status.information.category.meta.filename&&this.albumArt.fadeOut(500,function(){meta=that.status.information.category.meta;$(this).removeAttr("height").removeAttr("width").removeClass("hidden").attr("src","/art?"+meta.filename).fadeIn(500).error(function(){$(this).attr("src","img/vlc-48.png")});h1=meta.artist&&meta.title?meta.artist+" - "+meta.title:meta.title?meta.title:"Informations";that.infoModal.find("header h1").html('<span class="icon icon-info"></span> '+
h1).end().find(".content").empty().append($("<ul class=table-view>").append('<li class="table-view-divider">Meta</li>').append(meta.CONTENT_TYPE&&meta.genre?$("<li class=table-view-cell>").append(meta.CONTENT_TYPE).append("<p>"+meta.genre+"</p>"):"").append(meta.CONTENT_TYPE&&!meta.genre?$("<li class=table-view-cell>").append("Type").append("<p>"+meta.CONTENT_TYPE+"</p>"):"").append(void 0!=meta.artist?$("<li class=table-view-cell>").append("Artist").append("<p>"+meta.artist+"</p>"):"").append(void 0!=
meta.title?$("<li class=table-view-cell>").append("Title").append("<p>"+(0<meta.track_number&&0<meta.track_total?"["+meta.track_number+"/"+meta.track_total+"] - ":0<meta.track_number?meta.track_number+". ":"")+meta.title+"</p>"):"").append(void 0!=meta.album&&"Film"!=meta.CONTENT_TYPE&&"TV Show"!=meta.CONTENT_TYPE?$("<li class=table-view-cell>").append("Album").append("<p>"+meta.album+"</p>"):"").append(meta.genre&&!meta.CONTENT_TYPE?$("<li class=table-view-cell>").append("Genre").append("<p>"+meta.genre+
"</p>"):"").append(void 0!=meta.description?$("<li class=table-view-cell>").append("Summary").append("<p>"+nl2br(meta.description)+"</p>"):"").append(void 0!=meta.date?$("<li class=table-view-cell>").append("Release Date").append("<p>"+meta.date+"</p>"):"").append(void 0!=meta.ACTOR?$("<li class=table-view-cell>").append("Actors").append("<p>"+meta.ACTOR+"</p>"):"").append(void 0!=meta.CHARACTER?$("<li class=table-view-cell>").append("Characters").append("<p>"+meta.CHARACTER+"</p>"):"").append(void 0!=
meta.GUESTS?$("<li class=table-view-cell>").append("Guests").append("<p>"+meta.GUESTS+"</p>"):"").append(void 0!=meta.DIRECTOR?$("<li class=table-view-cell>").append("Director").append("<p>"+meta.DIRECTOR+"</p>"):"").append(void 0!=meta.WRITTEN_BY?$("<li class=table-view-cell>").append("Written By").append("<p>"+meta.WRITTEN_BY+"</p>"):"").append(void 0!=meta.RECORDING_LOCATION?$("<li class=table-view-cell>").append("Recording Location").append("<p>"+meta.RECORDING_LOCATION+"</p>"):""));i=0;that.streamModal.find("ul.table-view").empty();
for(isThereSubs=!1;c=that.status.information.category["Stream "+i];)"Audio"==c.Type?that.streamModal.find("ul.table-view").append($('<li class="table-view-cell">').append($('<span class="media-object pull-left icon icon-sound3">')).append("Audio "+(c.Language||"")).append(c.Channels?"<p>"+c.Channels+" ["+c.Codec+(c.Bitrate?" - "+c.Bitrate:"")+"]</p>":"").append(c.Description?"<p>"+c.Description+"</p>":"").append($('<button type="button" data-val="'+i+'" class="btn btn-outlined btn-primary">').append("Select").click(function(){that.sendCommand({command:"audio_track",
val:$(this).attr("data-val")});that.streamModal.parent().removeClass("active")}))):"Subtitle"==c.Type&&(isThereSubs=!0,that.streamModal.find("ul.table-view").append($('<li class="table-view-cell">').append($('<span class="media-object pull-left icon icon-bars">')).append("Subtitle "+(c.Language||"")).append(c.Description?"<p>"+c.Description+"</p>":"").append($('<button type="button" data-val="'+i+'" class="btn btn-primary btn-outlined">').append("Select").click(function(){that.sendCommand({command:"subtitle_track",
val:$(this).attr("data-val")});that.streamModal.parent().removeClass("active")})))),i++;isThereSubs&&that.streamModal.find("ul.table-view").append($('<li class="table-view-cell">').append($('<span class="media-object pull-left icon icon-bars">')).append("Disable Subtitles").append($('<button type="button" data-val="" class="btn btn-negative btn-outlined">').append("Disable").click(function(){that.sendCommand({command:"subtitle_track",val:"-1"});that.streamModal.parent().removeClass("active")})));
that.nSecondary=$("<div>",{"class":"bar bar-standard bar-header-secondary"}).append($("<button>",{type:"button","class":"btn pull-left control-item",html:"&laquo;"}).click(function(){that.Prev()})).append($("<button>",{type:"button","class":"btn pull-right control-item",html:"&raquo;"}).click(function(){that.Next()})).append($("<div>",{"class":"segmented-control"}).append($("<a>",{"class":"control-item",html:"Info",href:"#info"})).append($("<a>",{"class":"control-item",html:"Playlist",href:"#playlist"}).on("click touch touchend",
function(){$.ajax({url:server+"/requests/playlist.json",success:function(a){that.plModal.empty();that.buildPlaylist(a)},dataType:"json"})})).append($("<a>",{"class":"control-item",html:"Streams",href:"#streams"}))).appendTo("body");that.actualImg=meta.filename}):(this.nSecondary&&this.nSecondary.remove(),this.albumArt.attr("src","img/vlc-48.png"));return this},error:function(a){0==a?""!=this.errorDiv.find("p").text()?this.errorDiv.empty().append($("<p>",{text:"Connection to VLC is re-established !"})).append($("<button>",
{"class":"btn btn-positive",text:"Successful"})).fadeOut(2E3,function(){$(this).empty().fadeIn()}):this.errorDiv.empty():this.errorDiv.empty().append($("<p>",{text:a})).append($("<button>",{"class":"btn btn-negative",text:"Reconnecting..."}));return this}};function nl2br(a,b){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(b||"undefined"===typeof b?"<br />":"<br>")+"$2")}
String.prototype.toHHMMSS=function(){var a=parseInt(this,10),b=Math.floor(a/3600),d=Math.floor((a-3600*b)/60),a=a-3600*b-60*d;10>b&&(b="0"+b);10>d&&(d="0"+d);10>a&&(a="0"+a);return b+":"+d+":"+a};$(document).ready(function(){(new VLC).updateStatus();$("head").append($("<style type=text/css>").append(".slider .slide-group .slide-text {position: absolute;top: 45%;left: 0;width: 100%;font-size: 24px;color: #fff;text-align: center;text-shadow: 0 0 8px #da532c;}"))});