var VLCRemote=angular.module("VLCRemote",["ngTouch"]).factory("SettingsService",function(){var a={server:"http://"+window.location.hostname+":"+window.location.port,browser:"~",update:5,maxVol:!0,chapters:!0,forward:15,backward:15},f=function(a,g){return localStorage.setItem(a,g)},d={};angular.forEach(a,function(a,g){l=localStorage.getItem(g);switch(typeof a){case "boolean":"true"==l&&(l=!0);"false"==l&&(l=!1);this[g]=l!==!a;break;case "number":l=parseInt(l);default:case "String":this[g]=l||a}},d);
return{defaults:a,save:f,set:f,settings:d}}).factory("VLC",["$http","SettingsService","$timeout",function(a,f,d){var e=f.settings.server;req=function(e,b){return a({method:"GET",url:e,params:b})};sendCommand=function(a){"object"!=typeof a&&(a={command:a});return req(e+"/requests/status.json",a)};Browse=function(a){return req(e+"/requests/browse.json",{uri:a})};Playlist=function(a){data="object"==typeof a?a:a?{command:"pl_empty"}:{};return req(e+"/requests/playlist.json",data)};return{sendCommand:sendCommand,
Browse:Browse,Playlist:Playlist}}]).filter("seconds",[function(){return function(a){return(new Date(1970,0,1)).setSeconds(a)}}]).run(["VLC",function(a){}]).controller("Settings",["$scope","SettingsService",function(a,f){a.settings=f.settings;this.defaults=f.defaults;this.save=function(a,e){f.save(a,e)};this.toggle=function(d,e){a.settings[e]=!a.settings[e];this.save(e,a.settings[e])}}]).controller("Playlist",["$scope","VLC",function(a,f){this.load=function(d){return a.loadPlaylist(d)};this.Add=function(){reloadPlaylist=
1};this.Play=function(d){a.sendCommand({command:"pl_play",id:d});this.load();return!0};this.Clear=function(){a.status.state&&"stopped"!=a.status.state&&!confirm("Something is currently playing and will be stopped. Would you continue ?")||this.load(!0)}}]).controller("Browse",["$scope","VLC","SettingsService",function(a,f,d){this.load=function(e){f.Browse(e).then(function(e){a.browse=e.data})};this.load("file://"+d.settings.browser);this.Play=function(e){if("s"==this.Ext(e))return a.sendCommand({command:"addsubtitle",
val:e});a.sendCommand({command:"in_play",input:e});reloadPlaylist--&&a.loadPlaylist()};this.Queue=function(e){reloadPlaylist--?a.loadPlaylist({command:"in_enqueue",input:e}):a.sendCommand({command:"in_enqueue",input:e})};this.Ext=function(a){ext=a.substr(a.lastIndexOf(".")+1).toLowerCase();return-1<video_types.indexOf(ext)?"v":-1<audio_types.indexOf(ext)?"a":-1<playlist_types.indexOf(ext)?"p":-1<subtitle_types.indexOf(ext)?"s":!1}}]).controller("Status",["$scope","VLC","SettingsService","$filter",
"$interval",function(a,f,d,e,g){that=this;a.status={};a.confs=d.settings;a.sendCommand=function(b){f.sendCommand(b).then(function(b){a.status=b.data})};a.sendCommand({});this.updateInterval=g(a.sendCommand,1E3*d.settings.update,0,!0,{});a.closeModal=function(a){document.getElementById(a).classList.remove("active")};this.toggleFullscreen=function(){a.sendCommand("fullscreen")};this.Stop=function(){a.sendCommand("pl_stop")};this.PlayPause=function(){a.sendCommand("playing"==a.status.state?"pl_pause":
"pl_play")};this.volIcon=function(b){switch(Math.floor(a.status.volume/2.56/25)){default:case 0:return b?"icon-sound3":"icon-sound4";case 1:case 2:return b?"icon-sound2":"icon-sound3";case 3:case 4:case 5:case 6:case 7:case 8:return b?"icon-sound":"icon-sound2"}};this.Vol=function(b){return(256<=a.status.volume||230<a.status.volume)&&b&&a.confs.maxVol?a.sendCommand({command:"volume",val:256}):26>=a.status.volume&&!b?a.sendCommand({command:"volume",val:0}):a.sendCommand({command:"volume",val:b?a.status.volume+
26:a.status.volume-26})};this.sliderSize=function(){w=window.innerWidth-46-document.querySelector(".bar-footer-secondary .btn.control-item.pull-left").clientWidth-document.querySelector(".bar-footer-secondary .btn.control-item.pull-right").clientWidth;angular.element(document.querySelector(".bar-footer-secondary input[type=range]")).css("width",w+"px")};angular.element(window).on("resize",function(){that.sliderSize()});angular.element(document).ready(function(){that.sliderSize()});this.pos=new function(){this.timeout=
null;this.__defineGetter__("pos",function(){return a.status.position});this.__defineSetter__("pos",function(b){a.status.position=parseFloat(b);this.timeout&&clearTimeout(this.timeout);t=this;this.timeout=setTimeout(function(){that.Seek(t.val)},100)});this.__defineGetter__("val",function(){return Math.round(this.pos*this.len)});this.__defineSetter__("val",function(){});this.__defineGetter__("len",function(){return a.status.length});this.__defineSetter__("len",function(){})};this.Seek=function(b){!0===
b&&(b="+"+d.settings.forward+"s");!1===b&&(b="-"+d.settings.backward+"s");if("undefined"==typeof b)return!1;a.sendCommand({command:"seek",val:b})};this.Chapter=function(b){chaps=a.status.information.chapters;currchap=a.status.information.chapter;if(1<chaps.length&&d.settings.chapters)if(b){if(currchap<chaps.length)return a.sendCommand({command:"chapter",val:currchap+1})}else if(0<currchap)return a.sendCommand({command:"chapter",val:currchap-1});return this.Swipe(b)};this.Swipe=function(b){return a.sendCommand(b?
"pl_next":"pl_previous")};this.info={keys:{CONTENT_TYPE:"Type",title:"Title",artist:"Artist",album:"Album",genre:"Genre",description:"Summary",date:"Release Date",ACTOR:"Actors",CHARACTER:"Characters",GUESTS:"Guests",DIRECTOR:"Director",PRODUCER:"Producer",WRITTEN_BY:"Written by",EXECUTIVE_PRODUCER:"Executive Producer(s)",DIRECTOR_OF_PHOTOGRAPHY:"Director of Photography",SOUND_ENGINEER:"Sound Engineers",PRODUCTION_DESIGNER:"Production Designer",PRODUCTION_STUDIO:"Production Studio",RECORDING_LOCATION:"Recording Location"},
buildArr:function(){arr=a.status;if(!arr.information)return!1;arr=arr.information.category.meta;var b=[];angular.forEach(this.keys,function(a,d){if(arr[d]){if("CONTENT_TYPE"==d&&arr.genre)return b.push({key:arr[d],val:arr.genre});if("album"!=d||"TV Show"!=arr.CONTENT_TYPE&&"Film"!=arr.CONTENT_TYPE)return"title"==d&&arr.track_number?arr.track_total?b.push({key:a,val:"["+arr.track_number+"/"+arr.track_total+"] "+arr[d]}):b.push({key:a,val:arr.track_number+". "+arr[d]}):"date"==d?b.push({key:a,val:e("date")(arr[d],
"longDate")}):b.push({key:a,val:arr[d]})}});return this.infos=b},infos:[]};a.$watch("status",function(a,d){a.information&&d.information&&a.information.category.meta.filename==d.information.category.meta.filename||(that.info.buildArr(),that.streams.buildArr())});this.streams={buildArr:function(){arr=a.status;if(!arr.information)return!1;arr=arr.information.category;i=0;subs=!1;for(this.streams=[];c=arr["Stream "+i];)"Subtitle"==c.Type&&(subs=!0),this.streams[i++]=c},streams:[],select:function(b){a.sendCommand({command:"subtitle_track",
val:b});a.closeModal("streams")}};a.loadPlaylist=function(b){f.Playlist(b).then(function(b){a.playlist=b.data.children})}}]).directive("fallbackSrc",function(){return{link:function(a,f,d){f.bind("error",function(){angular.element(this).attr("src",d.fallbackSrc)})}}}),reloadPlaylist=0,video_types="asf avi divx drc dv f4v flv gxf iso m1v m2v m2t m2ts m4v mkv mov mp2 mp4 mpeg mpeg1 mpeg2 mpeg4 mpg mts mtv mxf mxg nuv ogg ogm ogv ogx ps rec rm rmvb ts vob wmv xesc".split(" "),audio_types="3ga a52 aac ac3 ape awb dts flac it m4a m4p mka mlp mod mp1 mp2 mp3 oga ogg oma s3m spx thd tta wav wma wv xm".split(" "),
playlist_types="asx b4s cue ifo m3u m3u8 pls ram rar sdp vlc xspf".split(" "),subtitle_types=["srt","idx","ass","ssa","sup"];